<!DOCTYPE html>
<html lang="ko" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIBE.LOG</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        tailwind.config = { darkMode: 'class' };
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;700;900&display=swap');
        body { font-family: 'Pretendard', sans-serif; }
        .prose img { border-radius: 0.75rem; margin: 2rem auto; box-shadow: 0 10px 30px -10px rgba(0,0,0,0.3); }
        .prose a { color: #3b82f6; text-decoration: underline; }
        .hidden { display: none; }
        /* 스크롤바 디자인 */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        .dark ::-webkit-scrollbar-thumb { background: #334155; }
    </style>
</head>
<body class="bg-slate-100 dark:bg-[#020617] text-slate-900 dark:text-f1f5f9 selection:bg-blue-500/30 transition-colors duration-300">

    <nav class="sticky top-0 z-50 backdrop-blur-md bg-white/70 dark:bg-slate-950/70 border-b border-slate-200 dark:border-white/5">
        <div class="max-w-3xl mx-auto px-6 h-16 flex items-center justify-between">
            <a href="#" onclick="router.go('list')" class="text-xl font-black tracking-tighter text-blue-600 dark:text-blue-500">VIBE.LOG</a>
            <div class="flex gap-4 items-center">
                <button onclick="toggleDarkMode()" class="p-2 hover:bg-slate-200 dark:hover:bg-white/5 rounded-full transition-colors">
                    <i data-lucide="sun" class="w-5 h-5 hidden dark:block"></i>
                    <i data-lucide="moon" class="w-5 h-5 block dark:hidden"></i>
                </button>
                <button onclick="router.go('write')" class="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-full font-bold transition-all transform active:scale-95 text-sm">
                    <i data-lucide="pen-tool" class="w-4 h-4"></i> 글쓰기
                </button>
            </div>
        </div>
    </nav>

    <main class="max-w-3xl mx-auto px-6 py-12 min-h-screen">
        <section id="view-list" class="view space-y-12">
            <header class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <h2 class="text-4xl font-black tracking-tight text-slate-900 dark:text-white">LATEST LOGS</h2>
                <div class="relative w-full md:w-auto">
                    <input type="text" id="search-input" placeholder="검색..." 
                           class="w-full md:w-64 bg-white dark:bg-slate-900 border border-slate-200 dark:border-white/10 rounded-full px-5 py-3 text-sm focus:outline-none focus:border-blue-500 dark:focus:border-blue-500 transition-all shadow-sm">
                    <i data-lucide="search" class="w-5 h-5 absolute right-4 top-3.5 text-slate-400"></i>
                </div>
            </header>
            <div id="post-list" class="grid gap-8">
                </div>
        </section>

        <section id="view-detail" class="view hidden">
            <button onclick="router.go('list')" class="mb-8 flex items-center gap-2 text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white transition-colors font-bold">
                <i data-lucide="arrow-left" class="w-5 h-5"></i> 목록으로
            </button>
            <article id="post-content" class="prose dark:prose-invert max-w-none prose-headings:font-black prose-p:text-slate-700 dark:prose-p:text-slate-300 prose-a:no-underline hover:prose-a:underline">
                </article>
        </section>

        <section id="view-write" class="view hidden">
            <h2 class="text-3xl font-black mb-8 tracking-tight">새로운 기록</h2>
            <div class="space-y-8 bg-white dark:bg-slate-900 p-8 rounded-3xl shadow-xl dark:shadow-none border border-slate-200 dark:border-white/5">
                <input id="form-title" type="text" placeholder="제목을 입력하세요" class="w-full bg-transparent text-3xl font-black focus:outline-none border-b-2 border-slate-200 dark:border-white/10 focus:border-blue-500 dark:focus:border-blue-500 pb-4 transition-colors placeholder:text-slate-300 dark:placeholder:text-slate-700">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-bold text-slate-500 dark:text-slate-400 mb-2">카테고리 (쉼표로 구분)</label>
                        <input id="form-category" type="text" placeholder="예: 주식, 잡담, 코딩" class="w-full bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-white/10 rounded-xl p-4 text-sm focus:outline-none focus:border-blue-500 dark:focus:border-blue-500 transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-slate-500 dark:text-slate-400 mb-2">대표 이미지 (선택)</label>
                        <input type="file" id="form-image" accept="image/*" class="w-full bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-white/10 rounded-xl p-3 text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-bold file:bg-blue-50 dark:file:bg-blue-500/10 file:text-blue-600 dark:file:text-blue-400 hover:file:bg-blue-100 dark:hover:file:bg-blue-500/20 transition-all focus:outline-none">
                    </div>
                </div>

                <textarea id="form-body" rows="15" placeholder="당신의 생각을 마크다운으로 자유롭게 적어보세요..." class="w-full bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-white/10 rounded-xl p-5 text-base focus:outline-none focus:border-blue-500 dark:focus:border-blue-500 transition-all resize-none"></textarea>
                
                <button onclick="actions.submit()" id="btn-submit" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 py-5 rounded-xl font-black text-lg text-white transition-all transform active:scale-[0.98] shadow-lg shadow-blue-500/30 flex items-center justify-center gap-3">
                    <i data-lucide="send" class="w-6 h-6"></i> 블로그에 발행하기
                </button>
            </div>
        </section>
    </main>

    <footer class="py-8 text-center text-sm text-slate-500 dark:text-slate-600 border-t border-slate-200 dark:border-white/5 mt-12 font-medium">
        © 2026 Anonymous Vibe Log. Built for freedom.
    </footer>

    <script>
        // --- 1. 환경 설정 (GitHub 레포 정보 입력!) ---
        const CONFIG = {
            user: '본인_계정명', // 예: develop-king
            repo: '레포_이름', // 예: my-vibe-blog
            branch: 'main',
            postsPath: 'posts' // 레포 안에 이 폴더 미리 만들어두세요
        };

        // --- 2. 유틸리티 ---
        const toggleDarkMode = () => { document.documentElement.classList.toggle('dark'); lucide.createIcons(); };
        const fileToBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });

        // --- 3. 라우터 ---
        const router = {
            state: 'list', currentPost: null,
            go(view, id = null) {
                this.state = view; this.currentPost = id;
                document.querySelectorAll('.view').forEach(el => el.classList.add('hidden'));
                document.getElementById(`view-${view}`).classList.remove('hidden');
                window.scrollTo(0, 0);
                if (view === 'list') actions.fetchList();
                if (view === 'detail') actions.fetchDetail(id);
                lucide.createIcons();
            }
        };

        // --- 4. 핵심 액션 ---
        const actions = {
            async fetchList() {
                const listEl = document.getElementById('post-list');
                listEl.innerHTML = '<div class="py-20 text-center text-slate-500 font-medium animate-pulse">데이터 불러오는 중...</div>';
                try {
                    const res = await fetch(`https://api.github.com/repos/${CONFIG.user}/${CONFIG.repo}/contents/${CONFIG.postsPath}`);
                    const files = await res.json();
                    if (!Array.isArray(files)) throw new Error();
                    const posts = await Promise.all(files.reverse().filter(f => f.name.endsWith('.json')).map(async f => {
                        const r = await fetch(f.download_url); return { ...await r.json(), id: f.name };
                    }));
                    listEl.innerHTML = posts.map(p => `
                        <div onclick="router.go('detail', '${p.id}')" class="group cursor-pointer p-8 rounded-3xl bg-white dark:bg-slate-900/50 border border-slate-200 dark:border-white/5 hover:border-blue-500/50 hover:shadow-2xl hover:-translate-y-1 transition-all relative overflow-hidden">
                            <div class="absolute inset-0 bg-gradient-to-r from-blue-500/5 to-purple-500/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                            <div class="relative z-10">
                                <div class="flex gap-2 mb-5">
                                    ${p.category?.split(',').map(cat => `<span class="text-[11px] px-3 py-1 rounded-full bg-blue-100 dark:bg-blue-500/10 text-blue-600 dark:text-blue-400 font-bold uppercase tracking-wider">${cat.trim()}</span>`).join('')}
                                </div>
                                <h3 class="text-3xl font-black group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors mb-4 leading-tight">${p.title}</h3>
                                <p class="text-slate-600 dark:text-slate-400 text-base line-clamp-3 mb-6 leading-relaxed">${p.content.substring(0, 200)}...</p>
                                <div class="flex items-center justify-between border-t border-slate-100 dark:border-white/5 pt-6">
                                    <span class="text-xs text-slate-500 dark:text-slate-600 font-bold">${p.date}</span>
                                    <span class="text-blue-600 dark:text-blue-500 text-sm font-bold flex items-center gap-1 group-hover:gap-2 transition-all">Read More <i data-lucide="arrow-right" class="w-4 h-4"></i></span>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } catch (e) { listEl.innerHTML = '<div class="py-20 text-center text-red-500 font-bold">글이 없거나 설정이 잘못되었습니다.</div>'; }
            },
            async fetchDetail(id) {
                const detailEl = document.getElementById('post-content');
                detailEl.innerHTML = '<div class="py-20 text-center text-slate-500 animate-pulse">글 불러오는 중...</div>';
                try {
                    const res = await fetch(`https://api.github.com/repos/${CONFIG.user}/${CONFIG.repo}/contents/${CONFIG.postsPath}/${id}`);
                    const file = await res.json();
                    const data = JSON.parse(decodeURIComponent(escape(atob(file.content))));
                    detailEl.innerHTML = `
                        <header class="mb-12 pb-8 border-b border-slate-200 dark:border-white/5">
                            <div class="flex gap-2 mb-6">${data.category?.split(',').map(cat => `<span class="text-xs px-3 py-1 rounded-full bg-blue-100 dark:bg-blue-500/10 text-blue-600 dark:text-blue-400 font-bold uppercase">${cat.trim()}</span>`).join('')}</div>
                            <h1 class="text-5xl md:text-6xl font-black mb-8 leading-tight tracking-tight">${data.title}</h1>
                            <div class="flex items-center gap-3 text-slate-500 dark:text-slate-400 text-sm font-bold">
                                <i data-lucide="calendar" class="w-4 h-4"></i> <span>${data.date}</span>
                            </div>
                        </header>
                        ${data.image ? `<img src="${data.image}" alt="cover" class="w-full h-96 object-cover rounded-3xl mb-12 shadow-2xl">` : ''}
                        <div class="content text-lg leading-relaxed">${marked.parse(data.content)}</div>
                    `;
                } catch (e) { detailEl.innerHTML = '<div class="py-20 text-center text-red-500 font-bold">글을 불러올 수 없습니다.</div>'; }
            },
            async submit() {
                const btn = document.getElementById('btn-submit');
                const title = document.getElementById('form-title').value;
                const category = document.getElementById('form-category').value;
                const content = document.getElementById('form-body').value;
                const imageFile = document.getElementById('form-image').files[0];
                // 토큰 입력 제거: 대신 브라우저에 저장된 토큰을 사용하거나, 매번 입력받는 방식(보안상 권장)을 써야 합니다.
                // *중요* 이 방식은 GitHub Pages에서 직접 실행 시 CORS 및 보안 문제로 막힐 수 있습니다. 
                // 가장 현실적인 방법은 로컬에서 이 HTML을 열어서 글을 쓰고, 결과 JSON만 깃허브에 올리는 것입니다.
                const token = prompt("GitHub Personal Access Token을 입력하세요:"); // 임시 방편

                if (!title || !content || !token) return alert('제목, 내용, 토큰은 필수야.');

                btn.disabled = true; btn.innerHTML = '<i data-lucide="loader-2" class="w-6 h-6 animate-spin"></i> 업로드 중...';

                try {
                    const imageBase64 = imageFile ? await fileToBase64(imageFile) : null;
                    const fileName = `post-${Date.now()}.json`;
                    const payload = { title, category, content, image: imageBase64, date: new Date().toLocaleString() };

                    const res = await fetch(`https://api.github.com/repos/${CONFIG.user}/${CONFIG.repo}/contents/${CONFIG.postsPath}/${fileName}`, {
                        method: 'PUT', headers: { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' },
                        body: JSON.stringify({ message: `New Post: ${title}`, content: btoa(unescape(encodeURIComponent(JSON.stringify(payload)))) })
                    });
                    if (res.ok) { alert("발행 완료!"); router.go('list'); document.getElementById('form-title').value=''; document.getElementById('form-body').value=''; document.getElementById('form-image').value=''; } else throw new Error();
                } catch (e) { alert("실패. 토큰이나 권한 확인해봐."); } finally { btn.disabled = false; btn.innerHTML = '<i data-lucide="send" class="w-6 h-6"></i> 블로그에 발행하기'; lucide.createIcons(); }
            }
        };

        window.onload = () => {
            router.go('list');
            document.getElementById('search-input').oninput = (e) => {
                const term = e.target.value.toLowerCase();
                document.querySelectorAll('#post-list > div').forEach(card => card.style.display = card.innerText.toLowerCase().includes(term) ? 'block' : 'none');
            };
        };
    </script>
</body>
</html>
