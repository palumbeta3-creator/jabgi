<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>익명 Vibe 블로그</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #0f172a; color: #f8fafc; font-family: sans-serif; }
        .hidden { display: none; }
    </style>
</head>
<body class="max-w-2xl mx-auto p-6">

    <nav class="flex gap-4 mb-10 text-sm font-bold">
        <button onclick="showPage('list')" class="hover:text-blue-400">HOME</button>
        <button onclick="showPage('write')" class="hover:text-blue-400">WRITE</button>
    </nav>

    <section id="page-list">
        <h1 class="text-2xl mb-6 font-black text-blue-500 underline decoration-double">LATEST LOGS</h1>
        <div id="post-container" class="space-y-4">로드 중...</div>
    </section>

    <section id="page-write" class="hidden">
        <h1 class="text-2xl mb-6 font-black text-green-500">NEW POST</h1>
        <div class="space-y-4">
            <input id="post-title" type="text" placeholder="제목" class="w-full p-2 bg-slate-800 border border-slate-700 rounded">
            <textarea id="post-content" rows="10" placeholder="내용 (Markdown 가능)" class="w-full p-2 bg-slate-800 border border-slate-700 rounded"></textarea>
            <input id="gh-token" type="password" placeholder="GitHub Token 입력" class="w-full p-2 bg-slate-900 border border-red-900/50 rounded text-xs">
            <button onclick="submitPost()" class="w-full py-3 bg-blue-600 hover:bg-blue-500 font-bold rounded">발행하기 (GitHub Push)</button>
        </div>
    </section>

    <script>
        const CONFIG = {
            user: '본인_계정명',
            repo: '레포_이름',
            branch: 'main'
        };

        // 페이지 전환 함수
        function showPage(pageId) {
            document.getElementById('page-list').classList.toggle('hidden', pageId !== 'list');
            document.getElementById('page-write').classList.toggle('hidden', pageId !== 'write');
            if (pageId === 'list') loadPosts();
        }

        // DB(GitHub)에서 글 목록 가져오기
        async function loadPosts() {
            const container = document.getElementById('post-container');
            try {
                const res = await fetch(`https://api.github.com/repos/${CONFIG.user}/${CONFIG.repo}/contents/posts`);
                const files = await res.json();
                
                if (!Array.isArray(files)) { container.innerHTML = "글이 없습니다."; return; }

                const postData = await Promise.all(files.reverse().map(f => fetch(f.download_url).then(r => r.json())));
                container.innerHTML = postData.map(p => `
                    <div class="p-4 bg-slate-800/50 border border-slate-700 rounded-lg">
                        <h2 class="text-lg font-bold">${p.title}</h2>
                        <p class="text-sm text-slate-400 mt-2 whitespace-pre-wrap">${p.content}</p>
                        <div class="text-[10px] text-slate-600 mt-3">${p.date}</div>
                    </div>
                `).join('');
            } catch (e) { container.innerHTML = "설정을 확인하세요."; }
        }

        // 글쓰기 기능 (GitHub API 사용)
        async function submitPost() {
            const title = document.getElementById('post-title').value;
            const content = document.getElementById('post-content').value;
            const token = document.getElementById('gh-token').value;
            const date = new Date().toLocaleString();
            const fileName = `post-${Date.now()}.json`;

            const payload = {
                title, content, date
            };

            const res = await fetch(`https://api.github.com/repos/${CONFIG.user}/${CONFIG.repo}/contents/posts/${fileName}`, {
                method: 'PUT',
                headers: { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    message: `Add post: ${title}`,
                    content: btoa(unescape(encodeURIComponent(JSON.stringify(payload)))), // Base64 인코딩
                    branch: CONFIG.branch
                })
            });

            if (res.ok) {
                alert("발행 성공!");
                showPage('list');
            } else {
                alert("실패! 토큰이나 권한 확인해라.");
            }
        }

        loadPosts();
    </script>
</body>
</html>
