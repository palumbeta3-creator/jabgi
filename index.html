<!DOCTYPE html>
<html lang="ko" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="ë‚˜ë§Œì˜ ì¼ìƒ ê¸°ë¡">
  <title>VIBE.LOG</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3/dist/purify.min.js"></script>
  <!-- Quill rich text editor -->
  <link rel="stylesheet" href="https://cdn.quilljs.com/1.3.7/quill.snow.css">
  <script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
  <!-- Cropper.js -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css">
  <script>tailwind.config = { darkMode: 'class' };</script>
  <style>
    *, *::before, *::after { box-sizing: border-box; }
    body {
      font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, sans-serif;
      -webkit-font-smoothing: antialiased;
    }

    /* â”€â”€ Scrollbar â”€â”€ */
    ::-webkit-scrollbar { width: 4px; height: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 2px; }

    /* â”€â”€ Page transition â”€â”€ */
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(14px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .view-enter { animation: fadeUp 0.32s cubic-bezier(0.16, 1, 0.3, 1) forwards; }

    /* â”€â”€ Skeleton pulse â”€â”€ */
    @keyframes skeletonPulse {
      0%, 100% { opacity: 0.35; }
      50%       { opacity: 0.6; }
    }
    .skeleton { animation: skeletonPulse 1.6s ease-in-out infinite; }

    /* â”€â”€ Category filter: hide scrollbar â”€â”€ */
    #category-filter { overflow-x: auto; scrollbar-width: none; -webkit-overflow-scrolling: touch; }
    #category-filter::-webkit-scrollbar { display: none; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       Markdown legacy (ê¸°ì¡´ ë§ˆí¬ë‹¤ìš´ ê¸€ ë Œë”ë§)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .md h1 { font-size: 1.75rem;  font-weight: 900; line-height: 1.2; margin: 2.25rem 0 1rem; }
    .md h2 { font-size: 1.375rem; font-weight: 800; line-height: 1.3; margin: 2rem 0 0.75rem; }
    .md h3 { font-size: 1.125rem; font-weight: 700; line-height: 1.4; margin: 1.5rem 0 0.5rem; }
    .md p   { margin: 0.9rem 0; line-height: 1.9; color: #a1a1aa; font-size: 1.05rem; }
    .md a   { color: var(--accent, #f97316); text-decoration: underline; text-underline-offset: 3px; }
    .md strong { color: #f4f4f5; font-weight: 700; }
    .md em     { color: #d4d4d8; font-style: italic; }
    .md code { background: #27272a; color: #fb923c; padding: 0.1em 0.4em; border-radius: 4px; font-family: 'JetBrains Mono', monospace; font-size: 0.84em; }
    .md pre  { background: #18181b; border: 1px solid #27272a; padding: 1.25rem; border-radius: 0.75rem; overflow-x: auto; margin: 1.5rem 0; }
    .md pre code { background: none; color: #a1a1aa; padding: 0; font-size: 0.875rem; }
    .md blockquote { border-left: 2px solid var(--accent, #f97316); padding: 0.1rem 0 0.1rem 1.25rem; margin: 1.5rem 0; }
    .md blockquote p { color: #71717a !important; font-style: italic; }
    .md img { border-radius: 0.75rem; margin: 1.75rem auto; max-width: 100%; display: block; border: 1px solid #27272a; }
    .md ul  { padding-left: 1.5rem; margin: 0.875rem 0; list-style: disc; }
    .md ol  { padding-left: 1.5rem; margin: 0.875rem 0; list-style: decimal; }
    .md li  { margin: 0.35rem 0; line-height: 1.75; color: #a1a1aa; }
    .md hr  { border: none; border-top: 1px solid #27272a; margin: 2rem 0; }
    .md table { width: 100%; border-collapse: collapse; margin: 1.25rem 0; font-size: 0.9rem; }
    .md th { border-bottom: 1px solid #3f3f46; padding: 0.5rem 0.75rem; text-align: left; font-weight: 700; color: #f4f4f5; }
    .md td { border-bottom: 1px solid #27272a; padding: 0.5rem 0.75rem; color: #a1a1aa; }
    :not(.dark) .md p       { color: #52525b; }
    :not(.dark) .md strong  { color: #18181b; }
    :not(.dark) .md em      { color: #3f3f46; }
    :not(.dark) .md li      { color: #52525b; }
    :not(.dark) .md code    { background: #f4f4f5; color: #ea580c; }
    :not(.dark) .md pre     { background: #fafafa; border-color: #e4e4e7; }
    :not(.dark) .md pre code { color: #3f3f46; }
    :not(.dark) .md blockquote p { color: #71717a !important; }
    :not(.dark) .md th      { border-color: #d4d4d8; color: #18181b; }
    :not(.dark) .md td      { border-color: #e4e4e7; color: #52525b; }
    :not(.dark) .md hr      { border-color: #e4e4e7; }
    :not(.dark) .md img     { border-color: #e4e4e7; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       Quill â€” ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ë Œë”ë§ (ìƒˆ ê¸€ í˜•ì‹)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .rh { font-family: 'Pretendard Variable', Pretendard, sans-serif; }
    .rh p   { margin: 0.9rem 0; line-height: 1.9; color: #a1a1aa; font-size: 1.05rem; }
    .rh h1  { font-size: 1.75rem; font-weight: 900; line-height: 1.2; margin: 2.25rem 0 1rem; color: #f4f4f5; }
    .rh h2  { font-size: 1.375rem; font-weight: 800; line-height: 1.3; margin: 2rem 0 0.75rem; color: #f4f4f5; }
    .rh h3  { font-size: 1.125rem; font-weight: 700; line-height: 1.4; margin: 1.5rem 0 0.5rem; color: #f4f4f5; }
    .rh a   { color: var(--accent, #f97316); text-decoration: underline; text-underline-offset: 3px; }
    .rh strong { color: #f4f4f5; font-weight: 700; }
    .rh em     { font-style: italic; }
    .rh s      { text-decoration: line-through; color: #71717a; }
    .rh u      { text-underline-offset: 3px; }
    .rh blockquote { border-left: 2px solid var(--accent, #f97316); padding: 0.25rem 0 0.25rem 1.25rem; margin: 1.5rem 0; color: #71717a; font-style: italic; }
    .rh pre  { background: #18181b; border: 1px solid #27272a; padding: 1.25rem; border-radius: 0.75rem; overflow-x: auto; margin: 1.5rem 0; }
    .rh pre.ql-syntax { color: #a1a1aa; font-family: 'JetBrains Mono', monospace; font-size: 0.875rem; }
    .rh img  { border-radius: 0.75rem; margin: 1.75rem auto; max-width: 100%; display: block; border: 1px solid #27272a; }
    .rh ol   { padding-left: 1.5rem; margin: 0.875rem 0; list-style: decimal; }
    .rh ul   { padding-left: 1.5rem; margin: 0.875rem 0; list-style: disc; }
    .rh li   { margin: 0.35rem 0; line-height: 1.75; color: #a1a1aa; }
    .rh .ql-align-center   { text-align: center; }
    .rh .ql-align-right    { text-align: right; }
    .rh .ql-align-justify  { text-align: justify; }
    .rh .ql-size-small     { font-size: 0.8em; }
    .rh .ql-size-large     { font-size: 1.35em; }
    .rh .ql-size-huge      { font-size: 1.85em; font-weight: 900; }
    .rh hr { border: none; border-top: 1px solid #27272a; margin: 2rem 0; }
    :not(.dark) .rh p      { color: #52525b; }
    :not(.dark) .rh h1, :not(.dark) .rh h2, :not(.dark) .rh h3 { color: #18181b; }
    :not(.dark) .rh strong { color: #18181b; }
    :not(.dark) .rh li     { color: #52525b; }
    :not(.dark) .rh img    { border-color: #e4e4e7; }
    :not(.dark) .rh pre    { background: #fafafa; border-color: #e4e4e7; }
    :not(.dark) .rh pre.ql-syntax { color: #3f3f46; }
    :not(.dark) .rh hr     { border-color: #e4e4e7; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       Quill ì—ë””í„° UI â€” ë‹¤í¬ëª¨ë“œ
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .ql-toolbar.ql-snow  { border: none; border-bottom: 1px solid #e4e4e7; border-radius: 0.75rem 0.75rem 0 0; background: #fafafa; padding: 8px 12px; flex-wrap: wrap; }
    .ql-container.ql-snow { border: none; border-radius: 0 0 0.75rem 0.75rem; font-family: 'Pretendard Variable', Pretendard, sans-serif; }
    .ql-editor { min-height: 340px; font-size: 1rem; line-height: 1.8; padding: 16px 20px; }
    .ql-editor.ql-blank::before { font-style: normal; color: #a1a1aa; }
    .ql-snow .ql-picker.ql-header .ql-picker-label::before,
    .ql-snow .ql-picker.ql-header .ql-picker-item::before { font-family: 'Pretendard Variable', Pretendard, sans-serif; }

    .dark .ql-toolbar.ql-snow  { background: #18181b; border-bottom-color: #3f3f46; }
    .dark .ql-container.ql-snow { background: #18181b; }
    .dark .ql-editor { color: #e4e4e7; }
    .dark .ql-editor.ql-blank::before { color: #52525b; }
    .dark .ql-snow .ql-stroke  { stroke: #a1a1aa; }
    .dark .ql-snow .ql-fill    { fill: #a1a1aa; }
    .dark .ql-snow .ql-picker   { color: #a1a1aa; }
    .dark .ql-snow .ql-picker-options { background: #27272a; border-color: #3f3f46; }
    .dark .ql-snow .ql-picker-item:hover { color: #f97316; }
    .dark .ql-toolbar button:hover .ql-stroke { stroke: #f97316; }
    .dark .ql-toolbar button:hover .ql-fill   { fill:   #f97316; }
    .dark .ql-toolbar button.ql-active .ql-stroke { stroke: #f97316; }
    .dark .ql-toolbar button.ql-active .ql-fill   { fill:   #f97316; }
    .dark .ql-snow .ql-picker-label:hover  { color: #f97316; }
    .dark .ql-snow .ql-picker-label.ql-active { color: #f97316; }
    .dark .ql-snow .ql-tooltip { background: #27272a; border-color: #3f3f46; color: #e4e4e7; box-shadow: none; }
    .dark .ql-snow .ql-tooltip input { background: #18181b; border-color: #3f3f46; color: #e4e4e7; }
    .dark .ql-snow .ql-tooltip a.ql-action::after { border-right-color: #3f3f46; }

    /* â”€â”€ Crop modal â”€â”€ */
    .crop-aspect-btn { transition: all .15s; }
    .crop-aspect-btn.active { background: #f97316; color: #fff; border-color: #f97316; }
  </style>
</head>
<body class="bg-zinc-50 dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 min-h-screen transition-colors duration-200 selection:bg-orange-500/25">

  <!-- ìŠ¤í¬ë¡¤ ì§„í–‰ ë°” -->
  <div id="progress-bar" class="fixed top-0 left-0 h-[2px] z-[70] transition-[width] duration-100 ease-out pointer-events-none" style="width:0;background:var(--accent-color,#f97316);"></div>

  <!-- í† ìŠ¤íŠ¸ ì•Œë¦¼ -->
  <div id="toast" role="alert" aria-live="polite"
    class="fixed bottom-6 left-1/2 z-50 px-5 py-3 rounded-2xl text-sm font-bold shadow-2xl text-white pointer-events-none whitespace-nowrap opacity-0 transition-all duration-300"
    style="transform:translate(-50%,10px);background:#18181b;border:1px solid #3f3f46;"></div>

  <!-- ì´ë¯¸ì§€ í¬ë¡­ ëª¨ë‹¬ -->
  <div id="img-modal" class="fixed inset-0 z-[80] bg-black/75 backdrop-blur-sm flex items-center justify-center p-4 hidden">
    <div class="bg-white dark:bg-zinc-900 rounded-2xl border border-zinc-200 dark:border-zinc-800 w-full max-w-xl shadow-2xl overflow-hidden">
      <div class="flex items-center justify-between px-5 py-4 border-b border-zinc-200 dark:border-zinc-800">
        <h3 class="font-black text-base">ì´ë¯¸ì§€ í¸ì§‘</h3>
        <button onclick="closeImgModal()" class="text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 transition-colors"><i data-lucide="x" class="w-5 h-5"></i></button>
      </div>
      <!-- Cropper ì˜ì—­ -->
      <div class="bg-zinc-950 max-h-64 flex items-center justify-center overflow-hidden">
        <img id="crop-preview" class="max-w-full max-h-64 block" alt="crop">
      </div>
      <!-- ì»¨íŠ¸ë¡¤ -->
      <div class="p-5 space-y-4">
        <!-- ë¹„ìœ¨ -->
        <div>
          <p class="text-[10px] font-black uppercase tracking-widest text-zinc-400 mb-2">ë¹„ìœ¨</p>
          <div class="flex gap-2 flex-wrap">
            <button onclick="setCropAspect(null)"  class="crop-aspect-btn active text-xs px-3 py-1.5 rounded-lg border border-zinc-200 dark:border-zinc-700 font-bold text-zinc-600 dark:text-zinc-400" data-ratio="free">ììœ </button>
            <button onclick="setCropAspect(16/9)"  class="crop-aspect-btn text-xs px-3 py-1.5 rounded-lg border border-zinc-200 dark:border-zinc-700 font-bold text-zinc-600 dark:text-zinc-400" data-ratio="16:9">16:9</button>
            <button onclick="setCropAspect(4/3)"   class="crop-aspect-btn text-xs px-3 py-1.5 rounded-lg border border-zinc-200 dark:border-zinc-700 font-bold text-zinc-600 dark:text-zinc-400" data-ratio="4:3">4:3</button>
            <button onclick="setCropAspect(1)"     class="crop-aspect-btn text-xs px-3 py-1.5 rounded-lg border border-zinc-200 dark:border-zinc-700 font-bold text-zinc-600 dark:text-zinc-400" data-ratio="1:1">1:1</button>
            <button onclick="setCropAspect(3/4)"   class="crop-aspect-btn text-xs px-3 py-1.5 rounded-lg border border-zinc-200 dark:border-zinc-700 font-bold text-zinc-600 dark:text-zinc-400" data-ratio="3:4">3:4 (ì„¸ë¡œ)</button>
          </div>
        </div>
        <!-- ì¶œë ¥ í¬ê¸° -->
        <div>
          <p class="text-[10px] font-black uppercase tracking-widest text-zinc-400 mb-2">ì¶œë ¥ í¬ê¸°</p>
          <div class="flex gap-2">
            <button onclick="setCropSize('small')"  class="size-btn text-xs px-3 py-1.5 rounded-lg border border-zinc-200 dark:border-zinc-700 font-bold text-zinc-600 dark:text-zinc-400 hover:border-orange-400 transition-all">ì†Œ (320px)</button>
            <button onclick="setCropSize('medium')" class="size-btn text-xs px-3 py-1.5 rounded-lg border border-zinc-200 dark:border-zinc-700 font-bold text-zinc-600 dark:text-zinc-400 hover:border-orange-400 transition-all">ì¤‘ (640px)</button>
            <button onclick="setCropSize('full')"   class="size-btn active text-xs px-3 py-1.5 rounded-lg border border-zinc-200 dark:border-zinc-700 font-bold text-zinc-600 dark:text-zinc-400 hover:border-orange-400 transition-all">ì›ë³¸</button>
          </div>
        </div>
        <!-- íšŒì „ -->
        <div>
          <p class="text-[10px] font-black uppercase tracking-widest text-zinc-400 mb-2">íšŒì „</p>
          <div class="flex gap-2">
            <button onclick="cropperInst?.rotate(-90)" class="text-xs px-3 py-1.5 rounded-lg border border-zinc-200 dark:border-zinc-700 font-bold text-zinc-600 dark:text-zinc-400 hover:border-orange-400 transition-all">â†º 90Â°</button>
            <button onclick="cropperInst?.rotate(90)"  class="text-xs px-3 py-1.5 rounded-lg border border-zinc-200 dark:border-zinc-700 font-bold text-zinc-600 dark:text-zinc-400 hover:border-orange-400 transition-all">â†» 90Â°</button>
            <button onclick="cropperInst?.reset()"     class="text-xs px-3 py-1.5 rounded-lg border border-zinc-200 dark:border-zinc-700 font-bold text-zinc-600 dark:text-zinc-400 hover:border-orange-400 transition-all">ì´ˆê¸°í™”</button>
          </div>
        </div>
        <!-- ì•¡ì…˜ -->
        <div class="flex gap-3 pt-1">
          <button onclick="confirmCrop()" class="flex-1 bg-orange-500 hover:bg-orange-400 py-2.5 rounded-xl font-black text-sm text-white transition-all active:scale-[0.98]">ì‚½ì…í•˜ê¸°</button>
          <button onclick="closeImgModal()" class="px-5 py-2.5 rounded-xl border border-zinc-200 dark:border-zinc-700 text-sm font-bold text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100 transition-all">ì·¨ì†Œ</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ë‚´ë¹„ê²Œì´ì…˜ -->
  <header class="sticky top-0 z-40 px-4 pt-3 pb-2">
    <nav class="max-w-2xl mx-auto bg-white/85 dark:bg-zinc-900/85 backdrop-blur-xl rounded-2xl border border-zinc-200 dark:border-zinc-800 px-5 h-12 flex items-center justify-between shadow-sm">
      <button onclick="router.go('list')" class="text-sm font-black tracking-tight text-orange-500 hover:text-orange-400 transition-colors" style="font-family:'JetBrains Mono',monospace;">VIBE.LOG</button>
      <div class="flex gap-1 items-center">
        <button onclick="clearToken()" id="btn-clear-token" aria-label="í† í° ì´ˆê¸°í™”" title="ì €ì¥ëœ í† í° ì´ˆê¸°í™”" class="p-1.5 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg transition-colors text-zinc-300 dark:text-zinc-700 hover:text-zinc-500 dark:hover:text-zinc-400 hidden">
          <i data-lucide="key-round" class="w-4 h-4"></i>
        </button>
        <button onclick="toggleDark()" aria-label="ë‹¤í¬ëª¨ë“œ ì „í™˜" class="p-1.5 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg transition-colors text-zinc-400 hover:text-zinc-700 dark:hover:text-zinc-200">
          <i data-lucide="sun"  class="w-4 h-4 hidden dark:block"></i>
          <i data-lucide="moon" class="w-4 h-4 block dark:hidden"></i>
        </button>
        <button onclick="router.go('write')" class="flex items-center gap-1.5 bg-orange-500 hover:bg-orange-400 text-white px-3.5 py-1.5 rounded-xl font-bold text-sm transition-all active:scale-95">
          <i data-lucide="pen-line" class="w-3.5 h-3.5"></i> ìƒˆ ê¸€
        </button>
      </div>
    </nav>
  </header>

  <main class="max-w-2xl mx-auto px-4 py-8">

    <!-- â”€â”€ ëª©ë¡ ë·° â”€â”€ -->
    <section id="view-list" class="view">
      <div class="space-y-5 mb-8">
        <div>
          <h1 class="text-3xl font-black tracking-tight">ì¼ìƒì˜ ê¸°ë¡ë“¤.</h1>
          <p id="post-stats" class="mt-1 text-xs text-zinc-400 dark:text-zinc-600" style="font-family:'JetBrains Mono',monospace;"></p>
        </div>
        <div id="category-filter" class="flex gap-2 pb-1 -mb-1"></div>
        <div class="relative">
          <i data-lucide="search" class="w-4 h-4 absolute left-3.5 top-1/2 -translate-y-1/2 text-zinc-400"></i>
          <input type="text" id="search-input" placeholder="ì œëª©, ë‚´ìš©, ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰..."
            class="w-full bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl pl-10 pr-4 py-2.5 text-sm focus:outline-none focus:border-orange-400/60 dark:focus:border-orange-500/40 transition-all placeholder:text-zinc-400 dark:placeholder:text-zinc-600">
        </div>
      </div>
      <div id="post-list" class="space-y-3"></div>
    </section>

    <!-- â”€â”€ ìƒì„¸ ë·° â”€â”€ -->
    <section id="view-detail" class="view hidden">
      <button onclick="router.go('list')" class="group mb-10 flex items-center gap-1.5 text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 transition-colors text-sm font-bold">
        <i data-lucide="arrow-left" class="w-4 h-4 group-hover:-translate-x-0.5 transition-transform"></i> ëª©ë¡ìœ¼ë¡œ
      </button>
      <article id="post-content"></article>
    </section>

    <!-- â”€â”€ ì“°ê¸° ë·° â”€â”€ -->
    <section id="view-write" class="view hidden">
      <div class="flex items-center justify-between mb-6">
        <h2 id="write-title" class="text-xl font-black">ìƒˆë¡œìš´ ê¸°ë¡</h2>
        <button onclick="router.go('list')" aria-label="ë‹«ê¸°" class="p-1 text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 transition-colors">
          <i data-lucide="x" class="w-5 h-5"></i>
        </button>
      </div>

      <div class="bg-white dark:bg-zinc-900 rounded-2xl border border-zinc-200 dark:border-zinc-800 overflow-hidden">
        <!-- ìƒë‹¨ ë©”íƒ€ ì˜ì—­ -->
        <div class="p-6 space-y-5 border-b border-zinc-100 dark:border-zinc-800">
          <!-- ë¬´ë“œ ì„ íƒ -->
          <div>
            <p class="text-[10px] font-black uppercase tracking-widest text-zinc-400 mb-3">ì˜¤ëŠ˜ì˜ ë°”ì´ë¸Œ</p>
            <div class="flex gap-2 flex-wrap" id="mood-buttons"></div>
          </div>
          <!-- ì œëª© -->
          <input id="form-title" type="text" placeholder="ì˜¤ëŠ˜ ìˆì—ˆë˜ ì¼..."
            class="w-full bg-transparent text-xl font-black focus:outline-none border-b border-zinc-200 dark:border-zinc-800 focus:border-orange-400/60 dark:focus:border-orange-500/40 pb-3 transition-colors placeholder:text-zinc-300 dark:placeholder:text-zinc-700">
          <!-- ë©”íƒ€ -->
          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="block text-[10px] font-black uppercase tracking-widest text-zinc-400 mb-1.5" for="form-category">ì¹´í…Œê³ ë¦¬</label>
              <input id="form-category" type="text" placeholder="ì¼ìƒ, ì½”ë”©, ì¡ë‹´..."
                class="w-full bg-zinc-50 dark:bg-zinc-800/60 border border-zinc-200 dark:border-zinc-700 rounded-xl px-3 py-2 text-sm focus:outline-none focus:border-orange-400/60 dark:focus:border-orange-500/40 transition-all placeholder:text-zinc-400 dark:placeholder:text-zinc-600">
            </div>
            <!-- ì»¤ë²„ ì´ë¯¸ì§€ -->
            <div>
              <label class="block text-[10px] font-black uppercase tracking-widest text-zinc-400 mb-1.5">ì»¤ë²„ ì´ë¯¸ì§€ <span class="normal-case font-medium text-zinc-500">(í´ë¦­ í›„ í¬ë¡­)</span></label>
              <input type="file" id="form-image" accept="image/*" onchange="onCoverImageChange(event)"
                class="w-full bg-zinc-50 dark:bg-zinc-800/60 border border-zinc-200 dark:border-zinc-700 rounded-xl p-2 text-xs text-zinc-500 dark:text-zinc-400 cursor-pointer focus:outline-none file:mr-2 file:py-1 file:px-2.5 file:rounded-lg file:border-0 file:text-[11px] file:font-bold file:bg-orange-500/10 file:text-orange-500 hover:file:bg-orange-500/20 transition-all">
              <!-- ì»¤ë²„ ë¯¸ë¦¬ë³´ê¸° -->
              <div id="cover-preview" class="hidden mt-2 relative">
                <img id="cover-img" class="w-full h-24 object-cover rounded-lg border border-zinc-200 dark:border-zinc-700" alt="cover">
                <button onclick="clearCoverImage()" class="absolute top-1.5 right-1.5 bg-zinc-900/80 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs hover:bg-red-500 transition-colors">Ã—</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Quill ì—ë””í„° -->
        <div id="quill-editor" class="bg-white dark:bg-zinc-900"></div>

        <!-- í•˜ë‹¨ ì•¡ì…˜ ì˜ì—­ -->
        <div class="px-6 py-4 border-t border-zinc-100 dark:border-zinc-800 space-y-4">
          <div class="flex items-center justify-between">
            <span id="word-count" class="text-[11px] text-zinc-400 dark:text-zinc-600" style="font-family:'JetBrains Mono',monospace;">0ì</span>
            <span class="text-[10px] text-zinc-400 dark:text-zinc-600" style="font-family:'JetBrains Mono',monospace;">âŒ˜+â†µ ë°œí–‰</span>
          </div>
          <button onclick="actions.submit()" id="btn-submit"
            class="w-full bg-orange-500 hover:bg-orange-400 py-3 rounded-xl font-black text-sm text-white transition-all active:scale-[0.98] flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
            <i data-lucide="send" class="w-4 h-4"></i> ë°œí–‰í•˜ê¸°
          </button>
          <div class="flex items-center justify-center gap-2">
            <label class="flex items-center gap-1.5 cursor-pointer select-none">
              <input type="checkbox" id="chk-remember-token" class="w-3.5 h-3.5 accent-orange-500 cursor-pointer">
              <span class="text-[11px] text-zinc-400 dark:text-zinc-600">ì´ ê¸°ê¸°ì—ì„œ í† í° ê¸°ì–µí•˜ê¸°</span>
            </label>
          </div>
          <p id="token-status" class="text-[11px] text-center -mt-3"></p>
        </div>
      </div>
    </section>

  </main>

  <footer class="max-w-2xl mx-auto px-4 pb-10 mt-16">
    <div class="border-t border-zinc-200 dark:border-zinc-800 pt-6 text-center">
      <p class="text-[11px] text-zinc-400 dark:text-zinc-700" style="font-family:'JetBrains Mono',monospace;">VIBE.LOG &mdash; ë‚´ ë©‹ëŒ€ë¡œì˜ ê¸°ë¡ &copy; 2026</p>
    </div>
  </footer>

  <script>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CONFIG
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    const CONFIG = {
      user:      'palumbeta3-creator',
      repo:      'jabgi',
      branch:    'main',
      postsPath: 'posts',
    };

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CONSTANTS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    const MOODS = {
      fire:  { emoji: 'ğŸ”¥', label: 'ì—´ì •', color: '#f97316', bg: 'rgba(249,115,22,.12)'  },
      happy: { emoji: 'ğŸ˜Š', label: 'í–‰ë³µ', color: '#eab308', bg: 'rgba(234,179,8,.12)'   },
      calm:  { emoji: 'ğŸ˜Œ', label: 'í‰ì˜¨', color: '#22c55e', bg: 'rgba(34,197,94,.12)'   },
      blue:  { emoji: 'ğŸ˜”', label: 'ìš°ìš¸', color: '#6366f1', bg: 'rgba(99,102,241,.12)'  },
      think: { emoji: 'ğŸ¤”', label: 'ì‚¬ìƒ‰', color: '#a78bfa', bg: 'rgba(167,139,250,.12)' },
      rage:  { emoji: 'ğŸ˜¤', label: 'ë¶„ë…¸', color: '#ef4444', bg: 'rgba(239,68,68,.12)'   },
    };

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       STATE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    let allPosts       = [];
    let activeMood     = null;
    let activeCategory = null;
    let editMode       = null;
    let quill          = null;
    let coverImageData = null;
    let cropperInst    = null;
    let cropCallback   = null;
    let cropSize       = 'full';

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       UTILS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    const esc = s => String(s ?? '').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    const readingTime = text => Math.max(1, Math.round(((text ?? '').match(/[\wê°€-í£]+/g) ?? []).length / 220));
    const safeImg = src => (src?.startsWith('data:image/') || /^https?:\/\//.test(src ?? '')) ? src : null;
    const fileToBase64 = f => new Promise((res, rej) => { const r = new FileReader(); r.readAsDataURL(f); r.onload = () => res(r.result); r.onerror = rej; });
    const toB64   = str => btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/gi, (_, p) => String.fromCharCode(parseInt(p, 16))));
    const fromB64 = b64 => decodeURIComponent([...atob(b64.replace(/\n/g, ''))].map(c => '%' + c.charCodeAt(0).toString(16).padStart(2, '0')).join(''));
    const sanitize = html => typeof DOMPurify !== 'undefined' ? DOMPurify.sanitize(html, { ADD_ATTR: ['style', 'class'] }) : html;
    const stripHtml = html => (html ?? '').replace(/<[^>]*>/g, ' ').replace(/\s+/g, ' ').trim();

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TOKEN MANAGER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function getToken() {
      const cached = sessionStorage.getItem('vibe-token') || localStorage.getItem('vibe-token');
      if (cached) return cached;
      const token = prompt('GitHub Personal Access Token:');
      if (!token?.trim()) return null;
      const remember = document.getElementById('chk-remember-token')?.checked;
      if (remember) localStorage.setItem('vibe-token', token.trim());
      else          sessionStorage.setItem('vibe-token', token.trim());
      updateTokenUI();
      return token.trim();
    }

    function clearToken() {
      sessionStorage.removeItem('vibe-token');
      localStorage.removeItem('vibe-token');
      updateTokenUI();
      showToast('í† í°ì´ ì´ˆê¸°í™”ëì–´ìš”.');
    }

    function updateTokenUI() {
      const has    = !!(sessionStorage.getItem('vibe-token') || localStorage.getItem('vibe-token'));
      const isPerm = !!localStorage.getItem('vibe-token');
      const btn    = document.getElementById('btn-clear-token');
      const status = document.getElementById('token-status');
      if (btn) btn.classList.toggle('hidden', !has);
      if (status) {
        status.textContent = has
          ? (isPerm ? 'ğŸ”‘ í† í° ì €ì¥ë¨ (ê¸°ê¸°ì— ì˜êµ¬ ë³´ê´€) â€” í‚¤ ì•„ì´ì½˜ìœ¼ë¡œ ì´ˆê¸°í™”' : 'ğŸ”‘ í† í° ì €ì¥ë¨ (íƒ­ ë‹«ìœ¼ë©´ ìë™ ì‚­ì œ)')
          : '';
        status.className = `text-[11px] text-center -mt-3 ${has ? 'text-orange-400' : ''}`;
      }
      lucide.createIcons();
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DARK MODE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    (() => { if (localStorage.getItem('vibe-dark') === 'false') document.documentElement.classList.remove('dark'); })();

    function toggleDark() {
      const on = document.documentElement.classList.toggle('dark');
      localStorage.setItem('vibe-dark', on);
      lucide.createIcons();
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TOAST
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    let toastTimer;
    function showToast(msg) {
      clearTimeout(toastTimer);
      const el = document.getElementById('toast');
      el.textContent = msg;
      el.style.opacity = '1';
      el.style.transform = 'translate(-50%, 0)';
      toastTimer = setTimeout(() => { el.style.opacity = '0'; el.style.transform = 'translate(-50%, 10px)'; }, 2800);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       IMAGE CROP MODAL
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function openImgModal(file, callback, defaultAspect) {
      cropCallback = callback;
      cropSize = 'full';
      document.getElementById('img-modal').classList.remove('hidden');
      document.querySelectorAll('.size-btn').forEach(b => b.classList.toggle('active', b.textContent.includes('ì›ë³¸')));

      const reader = new FileReader();
      reader.onload = e => {
        const img = document.getElementById('crop-preview');
        img.src = e.target.result;
        img.onload = () => {
          if (cropperInst) { cropperInst.destroy(); cropperInst = null; }
          cropperInst = new Cropper(img, {
            viewMode: 1, dragMode: 'move', autoCropArea: 1,
            aspectRatio: defaultAspect ?? NaN,
            guides: true, center: true, highlight: false,
          });
          // ë¹„ìœ¨ ë²„íŠ¼ ì´ˆê¸° ìƒíƒœ
          document.querySelectorAll('.crop-aspect-btn').forEach(b => {
            b.classList.remove('active');
            if ((defaultAspect == null && b.dataset.ratio === 'free') ||
                (defaultAspect === 16/9 && b.dataset.ratio === '16:9')) b.classList.add('active');
          });
        };
      };
      reader.readAsDataURL(file);
      lucide.createIcons();
    }

    function closeImgModal() {
      document.getElementById('img-modal').classList.add('hidden');
      if (cropperInst) { cropperInst.destroy(); cropperInst = null; }
      cropCallback = null;
    }

    function setCropAspect(ratio) {
      if (cropperInst) cropperInst.setAspectRatio(ratio ?? NaN);
      document.querySelectorAll('.crop-aspect-btn').forEach(b => b.classList.remove('active'));
      const label = ratio == null ? 'free' : ratio === 16/9 ? '16:9' : ratio === 4/3 ? '4:3' : ratio === 1 ? '1:1' : '3:4';
      document.querySelector(`[data-ratio="${label}"]`)?.classList.add('active');
    }

    function setCropSize(size) {
      cropSize = size;
      document.querySelectorAll('.size-btn').forEach(b => {
        b.classList.toggle('active', b.textContent.toLowerCase().includes(size === 'full' ? 'ì›ë³¸' : size === 'small' ? 'ì†Œ' : 'ì¤‘'));
        b.style.background = b.classList.contains('active') ? '#f97316' : '';
        b.style.color       = b.classList.contains('active') ? '#fff'    : '';
        b.style.borderColor = b.classList.contains('active') ? '#f97316' : '';
      });
    }

    function confirmCrop() {
      if (!cropperInst || !cropCallback) return;
      const sizeMap = { small: 320, medium: 640, full: 0 };
      const w = sizeMap[cropSize];
      const canvas = cropperInst.getCroppedCanvas(w > 0 ? { width: w, maxWidth: w } : {});
      cropCallback(canvas.toDataURL('image/jpeg', 0.88));
      closeImgModal();
    }

    /* â”€â”€ ì»¤ë²„ ì´ë¯¸ì§€ ì²˜ë¦¬ â”€â”€ */
    function onCoverImageChange(e) {
      const file = e.target.files[0];
      if (!file) return;
      openImgModal(file, dataUrl => {
        coverImageData = dataUrl;
        document.getElementById('cover-img').src = dataUrl;
        document.getElementById('cover-preview').classList.remove('hidden');
      }, 16/9);
    }

    function clearCoverImage() {
      coverImageData = null;
      document.getElementById('form-image').value = '';
      document.getElementById('cover-preview').classList.add('hidden');
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       QUILL ì´ˆê¸°í™”
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function initQuill() {
      if (quill) return;
      quill = new Quill('#quill-editor', {
        theme: 'snow',
        placeholder: 'ììœ ë¡­ê²Œ ì¨ë´. íˆ´ë°”ë¡œ ì„œì‹ì„ ë„£ê±°ë‚˜ ì´ë¯¸ì§€ë„ ì‚½ì… ê°€ëŠ¥í•´.',
        modules: {
          toolbar: {
            container: [
              [{ header: [1, 2, 3, false] }],
              [{ size: ['small', false, 'large', 'huge'] }],
              ['bold', 'italic', 'underline', 'strike'],
              [{ color: [] }, { background: [] }],
              [{ align: [] }],
              ['blockquote', 'code-block'],
              [{ list: 'ordered' }, { list: 'bullet' }],
              ['link', 'image'],
              ['clean'],
            ],
            handlers: {
              image: () => {
                const input = document.createElement('input');
                input.type = 'file'; input.accept = 'image/*';
                input.onchange = e => {
                  const file = e.target.files[0];
                  if (!file) return;
                  openImgModal(file, dataUrl => {
                    const range = quill.getSelection(true);
                    quill.insertEmbed(range.index, 'image', dataUrl);
                    quill.setSelection(range.index + 1);
                  });
                };
                input.click();
              },
            },
          },
        },
      });

      quill.on('text-change', () => {
        const len = quill.getLength() - 1;
        document.getElementById('word-count').textContent = `${Math.max(0, len).toLocaleString()}ì`;
        localStorage.setItem('vibe-draft-content', quill.root.innerHTML);
      });
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MOOD SELECTOR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function renderMoodButtons() {
      document.getElementById('mood-buttons').innerHTML =
        Object.entries(MOODS).map(([key, m]) => `
          <button onclick="selectMood('${key}')" data-mood="${key}"
            class="mood-btn text-xs px-3 py-1.5 rounded-lg border font-bold transition-all"
            style="border-color:#3f3f46;color:#71717a;">${m.emoji} ${m.label}</button>
        `).join('');
    }

    function selectMood(key) {
      activeMood = (activeMood === key) ? null : key;
      document.querySelectorAll('.mood-btn').forEach(btn => {
        const k = btn.dataset.mood, m = MOODS[k];
        if (k === activeMood) { btn.style.borderColor = m.color; btn.style.color = m.color; btn.style.background = m.bg; }
        else { btn.style.borderColor = '#3f3f46'; btn.style.color = '#71717a'; btn.style.background = ''; }
      });
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ROUTER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    const router = {
      go(view, id = null) {
        document.querySelectorAll('.view').forEach(el => { el.classList.add('hidden'); el.classList.remove('view-enter'); });
        const target = document.getElementById(`view-${view}`);
        target.classList.remove('hidden');
        void target.offsetWidth;
        target.classList.add('view-enter');
        window.scrollTo({ top: 0, behavior: 'smooth' });
        document.getElementById('progress-bar').style.width = '0';

        if (view === 'list') actions.fetchList();
        if (view === 'detail') actions.fetchDetail(id);
        if (view === 'write') {
          initQuill();
          editMode = null; activeMood = null; coverImageData = null;
          renderMoodButtons();
          loadDraft();
          document.getElementById('cover-preview').classList.add('hidden');
          document.getElementById('write-title').textContent = 'ìƒˆë¡œìš´ ê¸°ë¡';
          document.getElementById('btn-submit').innerHTML = '<i data-lucide="send" class="w-4 h-4"></i> ë°œí–‰í•˜ê¸°';
        }
        lucide.createIcons();
      }
    };

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DRAFT AUTOSAVE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function loadDraft() {
      const t = localStorage.getItem('vibe-draft-title')   ?? '';
      const c = localStorage.getItem('vibe-draft-content') ?? '';
      const k = localStorage.getItem('vibe-draft-cat')     ?? '';
      document.getElementById('form-title').value    = t;
      document.getElementById('form-category').value = k;
      if (quill) {
        quill.root.innerHTML = c || '';
        document.getElementById('word-count').textContent = `${Math.max(0, quill.getLength() - 1).toLocaleString()}ì`;
      }
      if (t || c) showToast('ì„ì‹œì €ì¥ëœ ê¸€ì„ ë¶ˆëŸ¬ì™”ì–´ìš”.');
    }

    function clearDraft() {
      ['vibe-draft-title', 'vibe-draft-content', 'vibe-draft-cat'].forEach(k => localStorage.removeItem(k));
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CATEGORY FILTER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function renderCategoryFilter() {
      const cats = [...new Set(allPosts.flatMap(p => (p.category ?? '').split(',').map(c => c.trim()).filter(Boolean)))];
      const el = document.getElementById('category-filter');
      if (!cats.length) { el.innerHTML = ''; return; }
      const btn = (label, val) => {
        const active = activeCategory === val;
        const onclick = val === null ? `setCategory(null)` : `setCategory('${esc(val)}')`;
        return `<button onclick="${onclick}" class="shrink-0 text-xs px-3 py-1.5 rounded-full font-bold border transition-all ${
          active ? 'bg-orange-500 text-white border-orange-500' : 'border-zinc-200 dark:border-zinc-700 text-zinc-500 hover:border-zinc-400 dark:hover:border-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300'
        }">${esc(label)}</button>`;
      };
      el.innerHTML = btn('ì „ì²´', null) + cats.map(c => btn(c, c)).join('');
    }

    function setCategory(cat) { activeCategory = cat; renderCategoryFilter(); applyFilters(); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SEARCH + FILTER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function applyFilters() {
      const term = document.getElementById('search-input').value.toLowerCase().trim();
      let posts = allPosts;
      if (activeCategory) posts = posts.filter(p => (p.category ?? '').split(',').map(c => c.trim()).includes(activeCategory));
      if (term) posts = posts.filter(p =>
        (p.title ?? '').toLowerCase().includes(term) ||
        (p.contentType === 'html' ? stripHtml(p.content) : (p.content ?? '')).toLowerCase().includes(term) ||
        (p.category ?? '').toLowerCase().includes(term)
      );
      renderPostCards(posts);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RENDER POST CARDS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function renderPostCards(posts) {
      const el = document.getElementById('post-list');
      if (!posts.length) { el.innerHTML = '<p class="py-16 text-center text-sm text-zinc-400">ê¸°ë¡ì´ ì—†ì–´ìš”.</p>'; return; }
      el.innerHTML = posts.map(p => {
        const mood = MOODS[p.mood] ?? null;
        const mc   = mood?.color ?? '#52525b';
        const mb   = mood?.bg    ?? 'transparent';
        const cats = (p.category ?? '').split(',').map(c => c.trim()).filter(Boolean);
        const rt   = readingTime(p.contentType === 'html' ? stripHtml(p.content) : p.content);
        const prev = p.contentType === 'html'
          ? stripHtml(p.content).slice(0, 150)
          : (p.content ?? '').replace(/[#*`>\[\]!_~\-]/g, '').replace(/\n+/g, ' ').trim().slice(0, 150);
        return `
          <article onclick="router.go('detail','${esc(p.id)}')" role="button" tabindex="0"
            onkeydown="if(event.key==='Enter')router.go('detail','${esc(p.id)}')"
            class="group cursor-pointer rounded-2xl border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900/60 hover:border-zinc-300 dark:hover:border-zinc-700 hover:bg-zinc-50/80 dark:hover:bg-zinc-900 transition-all overflow-hidden">
            <div class="h-[2px] w-full" style="background:${mc};"></div>
            <div class="p-5">
              <div class="flex items-start justify-between gap-3 mb-2.5">
                <div class="flex gap-1.5 flex-wrap">
                  ${mood ? `<span class="text-[11px] px-2.5 py-0.5 rounded-full font-bold" style="color:${mc};background:${mb};">${mood.emoji} ${mood.label}</span>` : ''}
                  ${cats.map(c => `<span class="text-[11px] px-2.5 py-0.5 rounded-full font-bold text-zinc-500 bg-zinc-100 dark:bg-zinc-800">${esc(c)}</span>`).join('')}
                </div>
                <span class="shrink-0 text-[11px] text-zinc-400 dark:text-zinc-600 pt-0.5" style="font-family:'JetBrains Mono',monospace;">${esc(p.date ?? '')}</span>
              </div>
              <h2 class="font-black text-lg leading-snug mb-2 group-hover:text-orange-500 dark:group-hover:text-orange-400 transition-colors">${esc(p.title ?? '')}</h2>
              ${prev ? `<p class="text-sm text-zinc-500 line-clamp-2 leading-relaxed mb-3">${esc(prev)}${prev.length >= 150 ? 'â€¦' : ''}</p>` : ''}
              <div class="flex items-center justify-between pt-3 border-t border-zinc-100 dark:border-zinc-800">
                <span class="text-[11px] text-zinc-400 dark:text-zinc-600" style="font-family:'JetBrains Mono',monospace;">${rt}ë¶„ ì½ê¸°</span>
                <span class="text-[11px] font-bold text-zinc-400 group-hover:text-orange-500 dark:group-hover:text-orange-400 transition-colors flex items-center gap-1">ê³„ì† ì½ê¸° <i data-lucide="arrow-right" class="w-3 h-3"></i></span>
              </div>
            </div>
          </article>`;
      }).join('');
      lucide.createIcons();
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SKELETON LOADING
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function showSkeleton() {
      document.getElementById('post-list').innerHTML = [1,2,3].map(() => `
        <div class="rounded-2xl border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900/60 overflow-hidden skeleton">
          <div class="h-[2px] bg-zinc-200 dark:bg-zinc-800"></div>
          <div class="p-5 space-y-3">
            <div class="flex gap-2"><div class="h-5 w-16 bg-zinc-200 dark:bg-zinc-800 rounded-full"></div></div>
            <div class="h-5 w-3/4 bg-zinc-200 dark:bg-zinc-800 rounded-lg"></div>
            <div class="h-4 w-full bg-zinc-100 dark:bg-zinc-800/50 rounded-lg"></div>
          </div>
        </div>`).join('');
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ACTIONS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    const actions = {

      async fetchList() {
        showSkeleton();
        try {
          const res = await fetch(`https://api.github.com/repos/${CONFIG.user}/${CONFIG.repo}/contents/${CONFIG.postsPath}`);
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          const files = await res.json();
          if (!Array.isArray(files)) throw new Error('posts í´ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ì–´ìš”');
          const jsonFiles = files.filter(f => f.name.endsWith('.json')).reverse();
          allPosts = await Promise.all(jsonFiles.map(async f => {
            const r = await fetch(f.download_url);
            return { ...(await r.json()), id: f.name };
          }));
          document.getElementById('post-stats').textContent = `${allPosts.length}ê°œì˜ ê¸°ë¡`;
          renderCategoryFilter();
          renderPostCards(allPosts);
        } catch (e) {
          document.getElementById('post-list').innerHTML =
            `<p class="py-16 text-center text-sm text-zinc-400">ì„¤ì • í•„ìš” â€” CONFIGì— user, repoë¥¼ ì…ë ¥í•´ë´.<br><span class="text-xs text-zinc-500 mt-1 block font-mono">${esc(e.message)}</span></p>`;
          document.getElementById('post-stats').textContent = '';
        }
      },

      async fetchDetail(id) {
        const el = document.getElementById('post-content');
        el.innerHTML = '<div class="py-20 text-center text-sm text-zinc-400 animate-pulse">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
        try {
          const res  = await fetch(`https://api.github.com/repos/${CONFIG.user}/${CONFIG.repo}/contents/${CONFIG.postsPath}/${id}`);
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          const file = await res.json();
          const data = JSON.parse(fromB64(file.content));

          const mood  = MOODS[data.mood] ?? null;
          const mc    = mood?.color ?? '#71717a';
          const cats  = (data.category ?? '').split(',').map(c => c.trim()).filter(Boolean);
          const plainText = data.contentType === 'html' ? stripHtml(data.content) : (data.content ?? '');
          const rt    = readingTime(plainText);
          // ë¦¬ì¹˜ í…ìŠ¤íŠ¸(html) vs ë ˆê±°ì‹œ ë§ˆí¬ë‹¤ìš´
          const body  = data.contentType === 'html'
            ? sanitize(data.content ?? '')
            : sanitize(marked.parse(data.content ?? ''));
          const cover = safeImg(data.image);

          el.style.setProperty('--accent', mc);
          document.getElementById('progress-bar').style.background = mc;
          document.documentElement.style.setProperty('--accent-color', mc);

          el.innerHTML = `
            <header class="mb-10 pb-8 border-b border-zinc-200 dark:border-zinc-800">
              <div class="flex gap-2 mb-5 flex-wrap">
                ${mood ? `<span class="text-xs px-3 py-1 rounded-full font-bold" style="color:${mc};background:${mood.bg};">${mood.emoji} ${mood.label}</span>` : ''}
                ${cats.map(c => `<span class="text-xs px-3 py-1 rounded-full font-bold text-zinc-500 bg-zinc-100 dark:bg-zinc-800">${esc(c)}</span>`).join('')}
              </div>
              <h1 class="text-4xl md:text-5xl font-black leading-tight tracking-tight mb-5">${esc(data.title ?? '')}</h1>
              <div class="flex items-center justify-between mt-5">
                <p class="text-xs text-zinc-400 dark:text-zinc-500" style="font-family:'JetBrains Mono',monospace;">
                  ${esc(data.date ?? '')} &nbsp;Â·&nbsp; ${rt}ë¶„ ì½ê¸°
                </p>
                <div class="flex gap-2">
                  <button onclick="actions.loadEdit('${esc(id)}')"
                    class="flex items-center gap-1.5 text-xs font-bold px-3 py-1.5 rounded-lg border border-zinc-200 dark:border-zinc-700 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100 hover:border-zinc-400 dark:hover:border-zinc-500 transition-all">
                    <i data-lucide="pencil" class="w-3 h-3"></i> ìˆ˜ì •
                  </button>
                  <button onclick="actions.delete('${esc(id)}')"
                    class="flex items-center gap-1.5 text-xs font-bold px-3 py-1.5 rounded-lg border border-zinc-200 dark:border-zinc-700 text-zinc-500 hover:text-red-500 hover:border-red-300 dark:hover:border-red-500/50 transition-all">
                    <i data-lucide="trash-2" class="w-3 h-3"></i> ì‚­ì œ
                  </button>
                </div>
              </div>
            </header>
            ${cover ? `<img src="${cover}" alt="ì»¤ë²„ ì´ë¯¸ì§€" class="w-full aspect-video object-cover rounded-2xl mb-10 border border-zinc-200 dark:border-zinc-800">` : ''}
            <div class="${data.contentType === 'html' ? 'rh' : 'md'}">${body}</div>
          `;
          lucide.createIcons();
        } catch (e) {
          el.innerHTML = `<div class="py-20 text-center text-sm text-zinc-400">ê¸€ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ì–´ìš”.<br><span class="text-xs text-zinc-500 mt-1 block font-mono">${esc(e.message)}</span></div>`;
        }
      },

      async loadEdit(id) {
        showToast('ê¸€ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');
        try {
          const res  = await fetch(`https://api.github.com/repos/${CONFIG.user}/${CONFIG.repo}/contents/${CONFIG.postsPath}/${id}`);
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          const file = await res.json();
          const data = JSON.parse(fromB64(file.content));

          editMode = { id, sha: file.sha, originalDate: data.date ?? '', originalImage: data.image ?? null };

          // Quill ì´ˆê¸°í™” í›„ ë‚´ìš© ë¡œë“œ
          initQuill();
          if (data.contentType === 'html') {
            quill.root.innerHTML = data.content ?? '';
          } else {
            // ë ˆê±°ì‹œ ë§ˆí¬ë‹¤ìš´: plain textë¡œ ì‚½ì…
            quill.setText(data.content ?? '');
          }
          document.getElementById('word-count').textContent = `${Math.max(0, quill.getLength() - 1).toLocaleString()}ì`;

          document.getElementById('form-title').value    = data.title    ?? '';
          document.getElementById('form-category').value = data.category ?? '';

          // ì»¤ë²„ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
          if (data.image) {
            coverImageData = data.image;
            const ci = document.getElementById('cover-img');
            ci.src = data.image;
            document.getElementById('cover-preview').classList.remove('hidden');
          } else {
            coverImageData = null;
            document.getElementById('cover-preview').classList.add('hidden');
          }

          // ë·° ì „í™˜
          document.querySelectorAll('.view').forEach(el => { el.classList.add('hidden'); el.classList.remove('view-enter'); });
          const target = document.getElementById('view-write');
          target.classList.remove('hidden');
          void target.offsetWidth;
          target.classList.add('view-enter');
          window.scrollTo({ top: 0, behavior: 'smooth' });

          renderMoodButtons();
          if (data.mood) selectMood(data.mood);
          document.getElementById('write-title').textContent = 'ê¸°ë¡ ìˆ˜ì •í•˜ê¸°';
          document.getElementById('btn-submit').innerHTML = '<i data-lucide="check" class="w-4 h-4"></i> ìˆ˜ì • ì™„ë£Œ';
          lucide.createIcons();
          showToast('ìˆ˜ì • ëª¨ë“œë¡œ ì „í™˜ëì–´ìš”.');
        } catch (e) {
          showToast(`ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ${e.message}`);
        }
      },

      async delete(id) {
        if (!confirm('ì •ë§ ì‚­ì œí• ê±°ì•¼? ë˜ëŒë¦´ ìˆ˜ ì—†ì–´.')) return;
        const token = getToken();
        if (!token) return;
        try {
          const metaRes = await fetch(`https://api.github.com/repos/${CONFIG.user}/${CONFIG.repo}/contents/${CONFIG.postsPath}/${id}`);
          if (!metaRes.ok) throw new Error(`HTTP ${metaRes.status}`);
          const file = await metaRes.json();
          const res = await fetch(
            `https://api.github.com/repos/${CONFIG.user}/${CONFIG.repo}/contents/${CONFIG.postsPath}/${id}`,
            { method: 'DELETE', headers: { Authorization: `token ${token}`, 'Content-Type': 'application/json' },
              body: JSON.stringify({ message: `delete: ${id}`, sha: file.sha, branch: CONFIG.branch }) }
          );
          if (!res.ok) { const err = await res.json().catch(() => ({})); throw new Error(err.message ?? `HTTP ${res.status}`); }
          showToast('ì‚­ì œ ì™„ë£Œ.');
          setTimeout(() => router.go('list'), 1000);
        } catch (e) { showToast(`ì‚­ì œ ì‹¤íŒ¨: ${e.message}`); }
      },

      async submit() {
        const btn     = document.getElementById('btn-submit');
        const title   = document.getElementById('form-title').value.trim();
        const cat     = document.getElementById('form-category').value.trim();
        const content = quill ? quill.root.innerHTML : '';
        const textLen = quill ? quill.getLength() - 1 : 0;

        if (!title)         { showToast('ì œëª©ì„ ì…ë ¥í•´ë´ ğŸ™‚'); return; }
        if (textLen < 1)    { showToast('ë‚´ìš©ì„ ì…ë ¥í•´ë´ ğŸ™‚'); return; }

        const token = getToken();
        if (!token) return;

        btn.disabled = true;
        btn.innerHTML = `<svg class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path></svg> ì—…ë¡œë“œ ì¤‘...`;

        try {
          const isEdit   = editMode !== null;
          const fileName = isEdit ? editMode.id : `post-${Date.now()}.json`;
          const payload  = {
            title, category: cat,
            content,
            contentType: 'html',
            mood: activeMood,
            image: coverImageData ?? (isEdit ? editMode.originalImage : null),
            date: isEdit
              ? `${editMode.originalDate} (ìˆ˜ì •ë¨)`
              : new Date().toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'short' }),
          };
          const body = { message: isEdit ? `edit: ${title}` : `post: ${title}`, content: toB64(JSON.stringify(payload, null, 2)), branch: CONFIG.branch };
          if (isEdit) body.sha = editMode.sha;

          const res = await fetch(
            `https://api.github.com/repos/${CONFIG.user}/${CONFIG.repo}/contents/${CONFIG.postsPath}/${fileName}`,
            { method: 'PUT', headers: { Authorization: `token ${token}`, 'Content-Type': 'application/json' }, body: JSON.stringify(body) }
          );
          if (!res.ok) { const err = await res.json().catch(() => ({})); throw new Error(err.message ?? `HTTP ${res.status}`); }

          clearDraft();
          showToast(isEdit ? 'ìˆ˜ì • ì™„ë£Œ! âœ…' : 'ë°œí–‰ ì™„ë£Œ! ğŸ‰');
          if (quill) quill.root.innerHTML = '';
          ['form-title', 'form-category'].forEach(id => { document.getElementById(id).value = ''; });
          clearCoverImage();
          activeMood = null; editMode = null;
          setTimeout(() => router.go('list'), 1200);
        } catch (e) {
          console.error(e);
          showToast(`ì‹¤íŒ¨: ${e.message}`);
        } finally {
          btn.disabled = false;
          btn.innerHTML = '<i data-lucide="send" class="w-4 h-4"></i> ë°œí–‰í•˜ê¸°';
          lucide.createIcons();
        }
      },
    };

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SCROLL PROGRESS BAR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    window.addEventListener('scroll', () => {
      if (!document.getElementById('view-detail').classList.contains('hidden')) {
        const pct = window.scrollY / (document.documentElement.scrollHeight - window.innerHeight) * 100;
        document.getElementById('progress-bar').style.width = Math.min(pct, 100) + '%';
      }
    }, { passive: true });

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       INIT
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    marked.setOptions({ breaks: true, gfm: true });

    window.addEventListener('load', () => {
      router.go('list');
      updateTokenUI();

      document.getElementById('search-input').addEventListener('input', applyFilters);
      document.getElementById('form-title').addEventListener('input',    e => localStorage.setItem('vibe-draft-title', e.target.value));
      document.getElementById('form-category').addEventListener('input', e => localStorage.setItem('vibe-draft-cat',   e.target.value));

      document.addEventListener('keydown', e => {
        if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') {
          if (!document.getElementById('view-write').classList.contains('hidden')) actions.submit();
        }
        if (e.key === 'Escape') closeImgModal();
      });
    });
  </script>
</body>
</html>
